const S="https://cfsite.brisbanesocialchess.workers.dev";const u=["dark","light","random"];let a=localStorage.getItem("theme")||"dark";const d=document.querySelector("#menu-toggle"),g=document.querySelector("#menu"),$=document.querySelector("#year"),f=document.querySelector(".form-registration"),h=document.querySelector(".form-contact"),q=document.querySelectorAll(".email-obfuscated"),y=document.querySelector("#theme-toggle");function M(){return new Date().getFullYear()}function p(){const e=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),r=Math.floor(Math.random()*256);return[e,t,r]}function b(e,t,r){const o=[e,t,r].map(n=>{const s=n/255;return s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4)});return o[0]*.2126+o[1]*.7152+o[2]*.0722}function I(){const e=document.documentElement.style;e.removeProperty("--bg-color"),e.removeProperty("--text-color"),e.removeProperty("--reverse-text-color"),e.removeProperty("--toggle-icon-color"),e.removeProperty("--toggle-icon-hover"),e.removeProperty("--role-shadow-rgb")}function F(){for(let t=0;t<100;t++){const[r,o,n]=p(),[s,i,c]=p(),l=b(r,o,n),m=b(s,i,c);if((Math.max(l,m)+.05)/(Math.min(l,m)+.05)>4.5){const P=`rgb(${r}, ${o}, ${n})`,T=`rgb(${s}, ${i}, ${c})`;return[P,T]}}return["rgb(255, 255, 255)","rgb(0, 0, 0)"]}function E(e){if(!e)return!1;const t=e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/);return t?t.slice(1,4).every(r=>parseInt(r,10)>=0&&parseInt(r,10)<=255):!1}function _(e=!1){if(!e){const o=JSON.parse(localStorage.getItem("randomColors")||"null");if(o?.bg&&o?.text&&E(o.bg)&&E(o.text))return[o.bg,o.text]}const[t,r]=F();return localStorage.setItem("randomColors",JSON.stringify({bg:t,text:r})),[t,r]}function v(e=!1){const[t,r]=_(e);document.documentElement.style.setProperty("--bg-color",t),document.documentElement.style.setProperty("--text-color",r),document.documentElement.style.setProperty("--reverse-text-color",t),document.documentElement.style.setProperty("--toggle-icon-color",r),document.documentElement.style.setProperty("--toggle-icon-hover",t),document.documentElement.style.setProperty("--role-shadow-rgb",r.match(/\d+/g).join(", "))}function N(e){e.length===1?alert(`Please fix the error: ${e.join(" ")}`):alert(`Please fix the following:
- ${e.join(`
- `)}`)}function w(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}$/.test(e)}function C(e){const t=[],r=M();e.fname?.trim()||t.push("First name is required."),e.lname?.trim()||t.push("Last name is required.");const o=e.birthyear?parseInt(e.birthyear,10):NaN,n=r-o;return e.birthyear?.trim()?isNaN(o)?t.push("Birth year must be a valid number."):(n<5||n>120)&&t.push("Age must be between 5 and 120 years old."):t.push("Birth year is required."),e.gender||t.push("Gender is required."),(!e.email?.trim()||!w(e.email))&&t.push("Valid email is required."),t}function O(e){const t=[];return e.name?.trim()||t.push("Name is required."),(!e.email?.trim()||!w(e.email))&&t.push("Valid email is required."),e.subject?.trim()||t.push("Subject is required."),e.message?.trim()||t.push("Message is required."),t}async function x(e,t,r){const o=new FormData(e),n=Object.fromEntries(o.entries()),s=r(n);if(s.length>0){N(s);return}try{const i=await fetch(t,{body:JSON.stringify(n),headers:{"Content-Type":"application/json"},method:"POST"});if(i?.ok&&i?.status===200)alert("✅ Submission successful!"),e.reset();else{const c="Something went wrong.";try{const m=(await i.json()).message||c;alert(`❌ Error: ${m}`)}catch(l){console.error("Error parsing JSON response:",l),alert(`❌ Error: ${c}`)}}}catch(i){alert("❌ Network error. Please try again."),console.error(i)}}f?.addEventListener("submit",async e=>{e.preventDefault(),await x(f,`${S}/api/register`,C)});h?.addEventListener("submit",async e=>{e.preventDefault(),await x(h,`${S}/api/contact`,O)});document.documentElement.setAttribute("data-theme",a);a==="random"&&v(!1);$.textContent=M();const j="moc.liamg@ssehclaicosenabsirb",A=j.split("").reverse().join("");q.forEach(e=>{e.getAttribute("data-email-href")!==null&&(e.href=`mailto:${A}`),e.getAttribute("data-email-content")!==null&&(e.textContent=A)});window.addEventListener("message",e=>{if(e.origin==="https://www.chess.com"&&e.data?.id&&typeof e.data?.frameHeight=="number"){const t=document.getElementById(e.data.id);t&&(t.style.height=`${e.data.frameHeight+37}px`)}});d&&g&&d.addEventListener("click",()=>{g.classList.toggle("hidden");const e=!g.classList.contains("hidden");d.setAttribute("aria-expanded",e)});y&&y.addEventListener("click",()=>{let e=u.indexOf(a);e=(e+1)%u.length,a=u[e],document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a),a==="random"?v(!0):I()});